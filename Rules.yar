/*
   WannaCry Ransomware Detection Rule Set
   Author: Florian Roth
   Date: 2017-05-12
   Reference: https://goo.gl/HG2j5T
*/

rule wannacry_mix{
   meta:
       description = "WannaCry Ransomware Detection Rule Set"
       author = "Florian Roth"
       date = "2023-05-21"
       reference = "https://goo.gl/HG2j5T"
       hash1 = "ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa"
       hash2 = "9fe91d542952e145f2244572f314632d93eb1e8657621087b2ca7f7df2b0cb05"
       hash3 = "51432d3196d9b78bdc9867a77d601caffd4adaa66dcac944a5ba0b3112bbea3b"
       hash4 = "f01b7f52e3cb64f01ddc248eb6ae871775ef7cb4297eba5d230d0345af9a5077"
       hash5 = "4a25d98c121bb3bd5b54e0b6a5348f7b09966bffeec30776e5a731813f05d49e"
       hash6 = "9c7c7149387a1c79679a87dd1ba755bc"
       hash7 = "ac21c8ad899727137c4b94458d7aa8d8"
       id = "2e46b4db-8c94-53ed-ae27-31dd37b04940"
       id = "d28d3d76-9c24-5476-9a0c-936c17477d6a"
       id = "a8f13bd2-984d-5c8c-ac53-7d442e222850"
       id = "0929f0de-28ac-5534-a6fd-7b131abda011"
       id = "65ce8faf-0981-5382-bc15-f094ccaa9f54"
       id = "e9dd9750-2366-503a-a879-972dbead6bf3"
       weight = 100

   strings:
   
      $s1 = "msg/m_bulgarian.wnry"
      $s2 = "msg/m_chinese (simplified).wnry"
      $s3 = "msg/m_chinese (traditional).wnry"
      $s4 = "msg/m_croatian.wnry"
      $s5 = "msg/m_czech.wnry"
      $s6 = "msg/m_danish.wnry"
      $s7 = "msg/m_dutch.wnry"
      $s8 = "msg/m_english.wnry"
      $s9 = "msg/m_filipino.wnry"
      $s10 = "msg/m_finnish.wnry"
      $s11 = "msg/m_french.wnry"
      $s12 = "msg/m_german.wnry"
      $s13 = "msg/m_greek.wnry"
      $s14 = "msg/m_indonesian.wnry"
      $s15 = "msg/m_italian.wnry"
      $s16 = "msg/m_japanese.wnry"
      $s17 = "msg/m_korean.wnry"
      $s18 = "msg/m_latvian.wnry"
      $s19 = "msg/m_norwegian.wnry"
      $s20 = "msg/m_polish.wnry"
      $s21 = "msg/m_portuguese.wnry"
      $s22 = "msg/m_romanian.wnry"
      $s23 = "msg/m_russian.wnry"
      $s24 = "msg/m_slovak.wnry"
      $s25 = "msg/m_spanish.wnry"
      $s26 = "msg/m_swedish.wnry"
      $s27 = "msg/m_turkish.wnry"
      $s28 = "msg/m_vietnamese.wnry"
      $x29 = "icacls . /grant Everyone:F /T /C /Q", fullword ascii
      $s30 = "@.exe\">> m.vbs" ascii
      $s31 = "cscript.exe //nologo m.vbs" fullword ascii
      $s32 = "echo SET ow = WScript.CreateObject(\"WScript.Shell\")> " ascii
      $s34 = "echo om.Save>> m.vbs" fullword ascii
      $s35 = "Ooops, your files have been encrypted!" wide ascii nocase
      $s36 = "Wanna Decryptor" wide ascii nocase
      $s37 = ".wcry" wide ascii nocase
      $s38 = "WANNACRY" wide ascii nocase
      $s39 = "WANACRY!" wide ascii nocase
      $s40 = "A:  Don't worry about decryption." fullword ascii
      $s41 = "Q:  What's wrong with my files?" fullword ascii
      $s42 = "taskdl.exe" fullword ascii
      $s43 = "tasksche.exe" fullword ascii
      $s44 = "Global\\MsWinZonesCacheCounterMutexA" fullword ascii
      $op1 = { 10 ac 72 0d 3d ff ff 1f ac 77 06 b8 01 00 00 00 }
      $op2 = { 44 24 64 8a c6 44 24 65 0e c6 44 24 66 80 c6 44 }
      $op3 = { 18 df 6c 24 14 dc 64 24 2c dc 6c 24 5c dc 15 88 }
      $op4 = { 09 ff 76 30 50 ff 56 2c 59 59 47 3b 7e 0c 7c }
      $op5 = { c1 ea 1d c1 ee 1e 83 e2 01 83 e6 01 8d 14 56 }
      $op6 = { 8d 48 ff f7 d1 8d 44 10 ff 23 f1 23 c1 }
      $a1 = { 51 53 55 8B 6C 24 10 56 57 6A 20 8B 45 00 8D 75
            04 24 01 0C 01 46 89 45 00 C6 46 FF 03 C6 06 01 46
            56 E8 }
      $a2 = { 03 00 04 00 05 00 06 00 08 00 09 00 0A 00 0D 00
            10 00 11 00 12 00 13 00 14 00 15 00 16 00 2F 00
            30 00 31 00 32 00 33 00 34 00 35 00 36 00 37 00
            38 00 39 00 3C 00 3D 00 3E 00 3F 00 40 00 41 00
            44 00 45 00 46 00 62 00 63 00 64 00 66 00 67 00
            68 00 69 00 6A 00 6B 00 84 00 87 00 88 00 96 00
            FF 00 01 C0 02 C0 03 C0 04 C0 05 C0 06 C0 07 C0
            08 C0 09 C0 0A C0 0B C0 0C C0 0D C0 0E C0 0F C0
            10 C0 11 C0 12 C0 13 C0 14 C0 23 C0 24 C0 27 C0
            2B C0 2C C0 FF FE }

   condition:
      uint16(0) == 0x3a51 and filesize < 2KB and all of them
      any of them
}
